using System.Runtime.InteropServices.JavaScript;
using MySqlCdc.Events;
using MySqlCdc.Parsers;
using MySqlCdc.Protocol;
using Xunit;

namespace MySqlCdc.Tests.Providers;

public class RowsQueryEventParserTests
{
    private static byte[] Payload =
    {
        0x29, 0x5b, 0x75, 0x65, 0x1d, 0x01, 0x00, 0x00, 0x00, 0x58, 0x00, 0x00, 0x00, 0xed, 0x0a, 0x00,
        0x00, 0x80, 0x00, 0x40, 0x49, 0x4e, 0x53, 0x45, 0x52, 0x54, 0x20, 0x49, 0x4e, 0x54, 0x4f, 0x20,
        0x74, 0x65, 0x73, 0x74, 0x5f, 0x72, 0x6f, 0x77, 0x73, 0x5f, 0x71, 0x75, 0x65, 0x72, 0x79, 0x5f,
        0x65, 0x76, 0x65, 0x6e, 0x74, 0x20, 0x56, 0x41, 0x4c, 0x55, 0x45, 0x53, 0x28, 0x27, 0x65, 0x78,
        0x61, 0x6d, 0x70, 0x6c, 0x65, 0x5f, 0x63, 0x6f, 0x6c, 0x75, 0x6d, 0x6e, 0x5f, 0x76, 0x61, 0x6c,
        0x75, 0x65, 0x27, 0x29, 0x84, 0x31, 0x35, 0xe1 
    };

    [Fact]
    public void Test_RowsQueryEvent_ReturnsEvent()
    {
        var reader = new PacketReader(Payload);
        var eventHeader = EventHeader.Read(ref reader);

        var parser = new RowsQueryEventParser();
        var @event = (RowsQueryEvent)parser.ParseEvent(eventHeader, ref reader);

        var query = new String("INSERT INTO test_rows_query_event VALUES('example_column_value')");
        Assert.Equal(query, @event.Query);
    }
}